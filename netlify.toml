[build]
  base = "frontend"
  command = "cd ../cryptic-cabin-bulk-data && npm install && node build.js && cd ../frontend && npm run build"

[[plugins]]
  package = "@netlify/plugin-nextjs"

[build.environment]
  NODE_VERSION = "20"

# Bulk Data API - Scheduled refresh daily at midnight UK time (GMT/BST)
# 0 0 * * * = midnight UTC (GMT), during BST this is 1 AM local
[functions."scheduled-refresh"]
  schedule = "0 0 * * *"

# Bulk Data API - CORS headers for JSON files
[[headers]]
  for = "/bulk-data/*"
  [headers.values]
    Access-Control-Allow-Origin = "*"
    Cache-Control = "public, max-age=3600"

# Bulk Data API - Endpoint redirects
[[redirects]]
  from = "/api/bulk-data"
  to = "/.netlify/functions/bulk-data"
  status = 200

[[redirects]]
  from = "/api/bulk-data/collection"
  to = "/.netlify/functions/bulk-data-collection"
  status = 200

# Cart Import API - For deck builder integrations (Moxfield, Archidekt, etc.)
[[redirects]]
  from = "/api/cart"
  to = "/.netlify/functions/cart"
  status = 200

[[redirects]]
  from = "/api/cart/import"
  to = "/.netlify/functions/cart-import"
  status = 200

[[redirects]]
  from = "/api/cart/lookup"
  to = "/.netlify/functions/cart-lookup"
  status = 200

# Helpdesk API - Support ticket system
[functions."helpdesk-email-poll"]
  schedule = "*/5 * * * *"

[[redirects]]
  from = "/api/helpdesk/reply"
  to = "/.netlify/functions/helpdesk-reply"
  status = 200

[[redirects]]
  from = "/api/helpdesk/webhook/messenger"
  to = "/.netlify/functions/helpdesk-messenger-webhook"
  status = 200

[[redirects]]
  from = "/api/helpdesk/webhook/instagram"
  to = "/.netlify/functions/helpdesk-instagram-webhook"
  status = 200

[[redirects]]
  from = "/api/helpdesk/notify"
  to = "/.netlify/functions/helpdesk-notify"
  status = 200